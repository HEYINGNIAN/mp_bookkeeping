<!-- pages/auth/auth.wxml -->
<view class="container">
  <view class="auth-container">
    <view class="auth-header">
      <text class="auth-title">🔐 {{mode === 'login' ? '用户登录' : '安全验证'}}</text>
      <text class="auth-subtitle">{{mode === 'login' ? '请输入您的主密码' : '设置主密码保护您的数据'}}</text>
    </view>

    <view class="auth-form card">
      <!-- 登录模式 -->
      <block wx:if="{{mode === 'login'}}">
        <view class="input-group">
          <text class="input-label">主密码</text>
          <view class="input-wrapper">
            <input class="input-field" password="{{!showPassword}}" placeholder="请输入主密码" bindinput="onPasswordInput" value="{{password}}" confirm-type="done" auto-height />
            <view class="eye-icon" bindtap="togglePasswordVisibility">
              <text>{{showPassword ? '👁️' : '👁️‍🗨️'}}</text>
            </view>
          </view>
        </view>

        <button class="btn-primary auth-btn" bindtap="handleSubmit" disabled="{{!canSubmit}}">
          登录
        </button>

        <view class="auth-actions">
          <text class="action-text" bindtap="goToSetup">忘记密码？重新设置</text>
        </view>
      </block>

      <!-- 设置密码模式 -->
      <block wx:elif="{{mode === 'setup'}}">
        <view class="input-group">
          <text class="input-label">主密码</text>
          <view class="input-wrapper">
            <input class="input-field" password="{{!showPassword}}" placeholder="请输入主密码" bindinput="onPasswordInput" value="{{password}}" confirm-type="done" auto-height />
            <view class="eye-icon" bindtap="togglePasswordVisibility">
              <text>{{showPassword ? '👁️' : '👁️‍🗨️'}}</text>
            </view>
          </view>
        </view>

        <view class="input-group">
          <text class="input-label">确认密码</text>
          <view class="input-wrapper">
            <input class="input-field" password="{{!showConfirmPassword}}" placeholder="请再次输入密码" bindinput="onConfirmPasswordInput" value="{{confirmPassword}}" confirm-type="done" auto-height />
            <view class="eye-icon" bindtap="toggleConfirmPasswordVisibility">
              <text>{{showConfirmPassword ? '👁️' : '👁️‍🗨️'}}</text>
            </view>
          </view>
        </view>

        <view class="password-strength" wx:if="{{password}}">
          <text class="strength-label">密码强度:</text>
          <view class="strength-bar">
            <view class="strength-fill {{passwordStrength}}"></view>
          </view>
          <text class="strength-text">{{strengthText}}</text>
        </view>

        <button class="btn-primary auth-btn" bindtap="handleSubmit" disabled="{{!canSubmit}}">
          {{isFirstTime ? '设置密码' : '修改密码'}}
        </button>

        <view class="auth-tips">
          <text class="tips-title">💡 安全提示:</text>
          <text class="tips-item">• 请使用强密码保护您的数据</text>
          <text class="tips-item">• 密码将用于加密所有敏感信息</text>
          <text class="tips-item">• 请妥善保管，忘记密码将无法恢复数据</text>
        </view>
      </block>
    </view>

    <view class="auth-footer">
      <text class="footer-text">您的数据安全是我们的首要任务</text>
    </view>
  </view>
</view>
