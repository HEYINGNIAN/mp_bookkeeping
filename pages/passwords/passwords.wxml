<!-- pages/passwords/passwords.wxml -->
<view class="container">
  <!-- 头部搜索和添加 -->
  <view class="header-section">
    <view class="search-bar card">
      <input class="search-input" placeholder="搜索密码..." bindinput="onSearchInput" value="{{searchKeyword}}" />
      <text class="search-icon">🔍</text>
    </view>
    <button class="btn-primary add-btn" bindtap="showAddModal">
      <text class="add-icon">+</text>
      添加密码
    </button>
  </view>

  <!-- 密码列表 -->
  <view class="passwords-list">
    <view class="password-item card fade-in" wx:for="{{filteredPasswords}}" wx:key="id">
      <view class="password-header">
        <view class="password-icon">{{item.icon}}</view>
        <view class="password-info">
          <text class="password-name">{{item.name}}</text>
          <text class="password-account">{{item.account}}</text>
        </view>
        <view class="password-actions">
          <text class="action-btn" bindtap="togglePassword" data-id="{{item.id}}">
            {{item.showPassword ? '👁️' : '👁️‍🗨️'}}
          </text>
          <text class="action-btn" bindtap="copyPassword" data-id="{{item.id}}">📋</text>
          <text class="action-btn" bindtap="editPassword" data-id="{{item.id}}">✏️</text>
          <text class="action-btn" bindtap="deletePassword" data-id="{{item.id}}">🗑️</text>
        </view>
      </view>
      
      <view class="password-content">
        <view class="password-field">
          <text class="field-label">密码:</text>
          <text class="field-value password-text">{{item.showPassword ? item.password : '••••••••'}}</text>
        </view>
        
        <view class="password-field" wx:if="{{item.url}}">
          <text class="field-label">网址:</text>
          <text class="field-value url-text" bindtap="openUrl" data-url="{{item.url}}">{{item.url}}</text>
        </view>
        
        <view class="password-field" wx:if="{{item.note}}">
          <text class="field-label">备注:</text>
          <text class="field-value note-text">{{item.note}}</text>
        </view>
      </view>
      
      <view class="password-footer">
        <text class="password-time">{{item.createTime}}</text>
        <view class="password-strength {{item.strength}}">{{item.strengthText}}</view>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{filteredPasswords.length === 0}}">
    <text class="empty-icon">🔐</text>
    <text class="empty-text">{{searchKeyword ? '没有找到相关密码' : '还没有保存密码'}}</text>
    <button class="btn-primary" bindtap="showAddModal" wx:if="{{!searchKeyword}}">添加第一个密码</button>
  </view>
</view>

<!-- 添加/编辑密码弹窗 -->
<view class="modal" wx:if="{{showModal}}">
  <view class="modal-content card">
    <view class="modal-header">
      <text class="modal-title">{{isEdit ? '编辑密码' : '添加密码'}}</text>
      <text class="modal-close" bindtap="hideModal">✕</text>
    </view>
    
    <view class="modal-body">
      <view class="input-group">
        <text class="input-label">名称</text>
        <input class="input-field" placeholder="例如: 微信登录" bindinput="onNameInput" value="{{formData.name}}" />
      </view>
      
      <view class="input-group">
        <text class="input-label">账号/邮箱</text>
        <input class="input-field" placeholder="请输入账号或邮箱" bindinput="onAccountInput" value="{{formData.account}}" />
      </view>
      
      <view class="input-group">
        <text class="input-label">密码</text>
        <view class="password-input-group">
          <input class="input-field password-input" type="{{showPasswordInput ? 'text' : 'password'}}" 
                 placeholder="请输入密码" bindinput="onPasswordInput" value="{{formData.password}}" />
          <text class="password-toggle" bindtap="togglePasswordInput">
            {{showPasswordInput ? '👁️' : '👁️‍🗨️'}}
          </text>
        </view>
        <view class="password-strength-indicator" wx:if="{{formData.password}}">
          <text class="strength-label">密码强度:</text>
          <view class="strength-bar">
            <view class="strength-fill {{passwordStrength}}"></view>
          </view>
          <text class="strength-text">{{strengthText}}</text>
        </view>
      </view>
      
      <view class="input-group">
        <text class="input-label">网址 (可选)</text>
        <input class="input-field" placeholder="https://example.com" bindinput="onUrlInput" value="{{formData.url}}" />
      </view>
      
      <view class="input-group">
        <text class="input-label">备注 (可选)</text>
        <textarea class="textarea-field" placeholder="添加备注信息" bindinput="onNoteInput" value="{{formData.note}}"></textarea>
      </view>
      
      <view class="input-group">
        <text class="input-label">图标</text>
        <scroll-view class="icon-selector" scroll-x="true">
          <text class="icon-item {{formData.icon === item ? 'selected' : ''}}" 
                wx:for="{{icons}}" 
                wx:key="*this" 
                wx:for-item="icon"
                bindtap="selectIcon" 
                data-icon="{{icon}}">{{icon}}</text>
        </scroll-view>
      </view>
    </view>
    
    <view class="modal-footer">
      <button class="btn-secondary" bindtap="hideModal">取消</button>
      <button class="btn-primary" bindtap="savePassword">保存</button>
    </view>
  </view>
</view>
